<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Leopard Lab â€” Start</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Helvetica Neue",
        Arial, sans-serif;
      background: #fff;
      color: #111;
      height: 100vh;
      overflow: hidden;
    }

    .page {
      position: relative;
      width: 100%;
      height: 100%;
    }

    /* ì˜¤ë¥¸ìª½ ìƒë‹¨ About / Moments */
    .top-nav {
      position: absolute;
      right: 40px;
      top: 30px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      z-index: 3;
    }

    .pill-btn {
      padding: 6px 18px;
      border-radius: 999px;
      border: 1px solid #111;
      background: #fff;
      font-size: 12px;
      cursor: pointer;
      transition: 0.2s ease;
    }

    .pill-btn:hover {
      background: #111;
      color: #fff;
    }

    /* ğŸ”¥ íŒ¨í„´ íƒ€ì¼ ê·¸ë¦¬ë“œ (ì—¬ë°± 0, í™”ë©´ ì „ì²´) */
    .archive-layer {
      position: absolute;
      inset: 0;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      grid-auto-rows: 120px;
      gap: 0;               /* ì—¬ë°± ì™„ì „ ì œê±° */
      z-index: 1;
    }

    .archive-tile {
      width: 100%;
      height: 100%;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }

    /* ê°€ìš´ë° ë¡œê³  + ë²„íŠ¼ */
    .hero {
      position: absolute;
      inset: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2;
      pointer-events: none;
    }

    .hero-inner {
      pointer-events: auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 40px;
    }

    /* ë¡œê³  í¬ê²Œ + hover invert */
    .logo-img {
      width: 560px;
      max-width: 95vw;
      height: auto;
      transition: filter 0.25s ease;
    }

    .logo-img:hover {
      filter: invert(1);
    }

    /* Enter LAB */
    .enter-btn {
      padding: 8px 40px;
      border-radius: 999px;
      background: #000;
      color: #fff;
      font-size: 16px;
      font-weight: 600;
      text-decoration: none;
      letter-spacing: 0.07em;
      cursor: pointer;
      transition: 0.2s ease;
      box-shadow: 0 10px 25px rgba(0,0,0,0.18);
    }

    .enter-btn:hover {
      transform: translateY(-3px) scale(1.03);
      background: #111;
      box-shadow: 0 8px 35px rgba(0,0,0,0.24);
    }

    @media (max-width: 768px) {
      .archive-layer {
        grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
        grid-auto-rows: 90px;
      }
      .logo-img {
        width: 420px;
      }
    }
  </style>
</head>

<body>
  <div class="page">

    <!-- ì˜¤ë¥¸ìª½ ìƒë‹¨ -->
    <div class="top-nav">
      <button class="pill-btn" onclick="window.location.href='about.html'">
        About
      </button>
      <button class="pill-btn"
              onclick="window.location.href='generator.html#archive'">
        Moments
      </button>
    </div>

    <!-- ğŸ”¥ íŒ¨í„´ íƒ€ì¼ ë ˆì´ì–´ (ì—¬ë°± 0, íŒ¨í„´ë§Œ) -->
    <div class="archive-layer" id="archiveLayer"></div>

    <!-- logo + enter -->
    <main class="hero">
      <div class="hero-inner">
        <img src="leopard-logo.svg" class="logo-img" alt="LEOPARD" />
        <a href="generator.html" class="enter-btn">Enter LAB</a>
      </div>
    </main>

  </div>

  <!-- Firestore ì—°ê²° -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
  import {
    getFirestore,
    collection,
    query,
    orderBy,
    limit,
    getDocs,
  } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyA_SEmwoDZaVpwrUvXC3bto9wq-qifApIM",
    authDomain: "leopard-lab.firebaseapp.com",
    projectId: "leopard-lab",
    storageBucket: "leopard-lab.firebasestorage.app",
    messagingSenderId: "255753558964",
    appId: "1:255753558964:web:cac3ccb9d28456919930e1",
    measurementId: "G-1TQLKCJ4RE"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const archiveLayer = document.getElementById("archiveLayer");

  let patternUrls = [];     // Firestoreì—ì„œ ê°€ì ¸ì˜¨ ì¸ë„¤ì¼ URLë“¤
  let shuffleTimer = null;  // 5ì´ˆ ë‹¨ìœ„ ëœë¤ ì¬ë°°ì¹˜ íƒ€ì´ë¨¸

  // í™”ë©´ì„ ê½‰ ì±„ìš°ê¸° ìœ„í•´ í•„ìš”í•œ íƒ€ì¼ ê°œìˆ˜ ê³„ì‚°
  function getTileCount() {
    const w = window.innerWidth;
    const h = window.innerHeight;

    // CSS ê¸°ì¤€: minmax(120px, 1fr)
    const tileW = 120;
    const tileH = 120;

    const columns = Math.ceil(w / tileW);
    const rows = Math.ceil(h / tileH);

    return columns * rows;
  }

  // Fisherâ€“Yates ì…”í”Œ
  function shuffleArray(arr) {
    const a = arr.slice();
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  // íŒ¨í„´ ë°°ì—´ì„ ê°€ì§€ê³  ì‹¤ì œ ê·¸ë¦¬ë“œë¥¼ ë‹¤ì‹œ ê·¸ë¦¬ëŠ” í•¨ìˆ˜
  function renderGrid() {
    if (!patternUrls.length) return;
    const need = getTileCount();

    // íŒ¨í„´ ë¶€ì¡±í•˜ë©´ ë°˜ë³µí•´ì„œ ì±„ìš°ê¸°
    let pool = patternUrls.slice();
    while (pool.length < need) {
      pool = pool.concat(pool);
    }

    // ëœë¤ ìˆœì„œë¡œ ì„ê³  í•„ìš”í•œ ë§Œí¼ë§Œ ì‚¬ìš©
    pool = shuffleArray(pool).slice(0, need);

    // ê¸°ì¡´ íƒ€ì¼ ë¹„ìš°ê³  ìƒˆë¡œ ì±„ìš°ê¸°
    archiveLayer.innerHTML = "";
    pool.forEach(url => {
      const tile = document.createElement("div");
      tile.className = "archive-tile";
      tile.style.backgroundImage = `url(${url})`;
      archiveLayer.appendChild(tile);
    });
  }

  async function loadArchives() {
    const q = query(
      collection(db, "archives"),
      orderBy("createdAt", "desc"),
      limit(100)   // ìµœëŒ€ 100ê°œê¹Œì§€ ê°€ì ¸ì˜¤ê¸°
    );

    const snap = await getDocs(q);

    patternUrls = [];
    snap.forEach((doc) => {
      const data = doc.data();
      if (data && data.thumbnailUrl) {
        patternUrls.push(data.thumbnailUrl);
      }
    });

    if (!patternUrls.length) return;

    // ìµœì´ˆ 1íšŒ ë Œë”
    renderGrid();

    // 5ì´ˆë§ˆë‹¤ ëœë¤ ì¬ë°°ì¹˜ (ì´ë¯¸ ì„¤ì •ë¼ ìˆìœ¼ë©´ ë‹¤ì‹œ ì•ˆ ë§Œë“¦)
    if (!shuffleTimer) {
      shuffleTimer = setInterval(renderGrid, 5000);
    }
  }

  // ìµœì´ˆ ë¡œë”©
  loadArchives();

  // í™”ë©´ í¬ê¸° ë°”ë€Œë©´ í•„ìš”í•œ íƒ€ì¼ ê°œìˆ˜ ë‹¬ë¼ì§€ë‹ˆê¹Œ ë‹¤ì‹œ ë Œë”
  window.addEventListener("resize", () => {
    renderGrid();
  });
</script>
</body>
</html>
